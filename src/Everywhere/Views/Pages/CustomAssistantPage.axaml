<UserControl
  x:Class="Everywhere.Views.Pages.CustomAssistantPage" xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:ai="clr-namespace:Everywhere.AI"
  xmlns:shadui="clr-namespace:ShadUI.Controls;assembly=ShadUI" xmlns:v="clr-namespace:Everywhere.Views"
  xmlns:vm="clr-namespace:Everywhere.ViewModels" x:DataType="vm:CustomAssistantPageViewModel">
  <Grid
    ColumnDefinitions="*,8,3*" RowDefinitions="Auto,*"
    RowSpacing="8">
    <StackPanel
      Grid.Row="0" Grid.Column="0"
      Orientation="Horizontal" Spacing="5">
      <Button
        Classes="Primary"
        shadui:ButtonAssist.Icon="{LucideIconContent Plus}"
        Command="{Binding CreateNewCustomAssistantCommand}"
        Content="{I18N {x:Static LocaleKey.CustomAssistantPage_CreateNewCustomAssistantButton_Content}}"
        ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_CreateNewCustomAssistantButton_ToolTip}}"/>

      <Button
        Classes="Secondary"
        shadui:ButtonAssist.Icon="{LucideIconContent Copy}"
        Command="{Binding DuplicateCustomAssistantCommand}"
        Content="{I18N {x:Static LocaleKey.CustomAssistantPage_DuplicateCustomAssistantButton_Content}}"
        IsVisible="{Binding SelectedCustomAssistant, Converter={x:Static ObjectConverters.IsNotNull}}"
        ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_DuplicateCustomAssistantButton_ToolTip}}"/>
    </StackPanel>

    <ListBox
      Grid.Row="1" Grid.Column="0"
      ItemsSource="{Binding CustomAssistants}"
      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
      SelectedItem="{Binding SelectedCustomAssistant, Mode=TwoWay}">
      <ListBox.Styles>
        <Style Selector="Border">
          <Setter Property="Background" Value="{DynamicResource CardBackgroundColor}"/>
        </Style>
      </ListBox.Styles>
      <ListBox.DataTemplates>
        <DataTemplate DataType="ai:CustomAssistant">
          <DockPanel
            HorizontalSpacing="12" LastChildFill="True">
            <v:IconPresenter
              DockPanel.Dock="Left" MinWidth="40"
              MinHeight="40"
              CornerRadius="{DynamicResource FullCornerRadius}"
              FontSize="{DynamicResource FontSize2Xl}"
              Icon="{Binding Icon}"
              IconSize="{DynamicResource FontSize2Xl}"
              LineHeight="{DynamicResource LineHeight2Xl}"/>

            <StackPanel VerticalAlignment="Center">
              <TextBlock
                Classes="p"
                Text="{Binding Name, FallbackValue={x:Null}}"
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding $self.Text}"/>

              <TextBlock
                Classes="Muted"
                IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                MaxLines="2"
                Text="{Binding Description}"
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding $self.Text}"/>
            </StackPanel>
          </DockPanel>
        </DataTemplate>
      </ListBox.DataTemplates>
    </ListBox>

    <GridSplitter
      Grid.Row="0" Grid.RowSpan="2"
      Grid.Column="1" VerticalAlignment="Stretch"
      Background="Transparent"/>

    <StackPanel
      Grid.Row="0" Grid.Column="2"
      HorizontalAlignment="Right" Orientation="Horizontal"
      Spacing="8">
      <Button
        Classes="Primary" Height="34"
        VerticalAlignment="Center"
        shadui:ButtonAssist.Icon="{LucideIconContent Unplug}"
        shadui:ButtonAssist.ShowProgress="{Binding CheckConnectivityCommand.IsRunning}"
        Command="{Binding CheckConnectivityCommand}"
        Content="{I18N {x:Static LocaleKey.CustomAssistantPage_CheckConnectivityButton_Content}}"
        IsVisible="{Binding SelectedCustomAssistant, Converter={x:Static ObjectConverters.IsNotNull}}"
        ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_CheckConnectivityButton_ToolTip}}"/>
      <Button
        Classes="Destructive" VerticalAlignment="Center"
        shadui:ButtonAssist.Icon="{LucideIconContent Trash2}"
        Command="{Binding DeleteCustomAssistantCommand}"
        Content="{I18N {x:Static LocaleKey.CustomAssistantPage_DeleteCustomAssistantButton_Content}}"
        IsVisible="{Binding SelectedCustomAssistant, Converter={x:Static ObjectConverters.IsNotNull}}"
        ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_DeleteCustomAssistantButton_ToolTip}}"/>
    </StackPanel>

    <ScrollViewer
      Grid.Row="1" Grid.Column="2"
      HorizontalScrollBarVisibility="Disabled">
      <v:SettingsItemsControl
        Margin="0,0,12,0"
        ItemsSource="{Binding SelectedCustomAssistant.SettingsItems, FallbackValue={x:Null}}"/>
    </ScrollViewer>
  </Grid>
</UserControl>